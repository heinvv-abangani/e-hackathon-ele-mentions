# Dynamic Insights Board - Product Requirements Document

## Overview

Transform the static `InsightsBoard.tsx` component into a dynamic system that consumes JSON data generated by the backend. The backend will process individual content entries (like those in `processed_entries.js`) and generate weekly digest JSON files that the frontend displays.

## Architecture

**Frontend Responsibility**: Display JSON data dynamically
**Backend Responsibility**: Data processing, AI generation, aggregation, filtering, and JSON creation

## JSON Template Structure

### Weekly Digest Schema

```json
{
  "week": {
    "year": 2025,
    "iso_week": 28,
    "date_range": {
      "start": "2025-07-07",
      "end": "2025-07-14"
    },
    "label": "Week of July 7–14"
  },
  "overview": {
    "summary": "This week's conversation around Editor V4 feels like a turning point...",
    "total_entries": 156,
    "total_mentions": 89,
    "avg_sentiment": -0.2
  },
  "features_discussed": [
    {
      "feature": "Styling System",
      "icon": "Palette",
      "color": "text-blue-600",
      "total_mentions": 12,
      "avg_sentiment": -0.1,
      "subthemes": [
        {
          "title": "Obfuscated Class Names Frustrate Developers",
          "mentions": 5,
          "sentiment": -0.7,
          "description": "The shift to a class-based styling system...",
          "quotes": [
            {
              "text": "I pray and hope Elementor… please do not let this be the case.",
              "relevance_score": 0.95,
              "entry_id": "ObjectId_reference"
            }
          ],
          "sources": [
            {
              "title": "Watch creator at 13:41",
              "url": "https://youtube.com/watch?v=example&t=821",
              "type": "youtube",
              "timestamp": "13:41"
            },
            {
              "title": "Reddit: 'This breaks my workflow' thread",
              "url": "https://reddit.com/r/elementor/comments/example",
              "type": "reddit"
            }
          ]
        }
      ]
    }
  ],
  "emerging_signals": [
    {
      "title": "SVG Widget Frustration Spikes",
      "mentions": 4,
      "sentiment": -0.5,
      "description": "The SVG widget drew heat this week...",
      "first_surfaced": "2025-07-07",
      "quotes": [
        {
          "text": "No icon library? Really?",
          "relevance_score": 0.88,
          "entry_id": "ObjectId_reference"
        }
      ],
      "sources": [
        {
          "title": "YouTube Review Discussion",
          "url": "https://youtube.com/watch?v=example2",
          "type": "youtube"
        }
      ]
    }
  ],
  "archive_weeks": [
    {
      "year": 2025,
      "iso_week": 28,
      "label": "Week of July 7–14",
      "current": true
    },
    {
      "year": 2025,
      "iso_week": 27,
      "label": "Week of June 30–July 6",
      "current": false
    }
  ]
}
```

## Data Requirements

### Backend Processing Requirements

The backend must process `processed_entries.js` style data and generate:

1. **Week Aggregation**
   - Group entries by `processed_at` timestamp into ISO weeks
   - Calculate total entries, mentions, and average sentiment per week

2. **Features Analysis**
   - Map from `features_discussed` arrays in processed entries
   - Group similar features (AI clustering)
   - Calculate sentiment aggregation using individual entry `sentiment.overall` values
   - Convert sentiment to -1 to 1 scale

3. **Subtheme Generation**
   - AI-generated subthemes based on `features_discussed` clustering
   - Maximum 3 subthemes per feature
   - Aggregate `mentions` by counting individual processed entries
   - Select top quotes based on `relevance_score`

4. **Source Link Resolution**
   - Use `raw_entry_id` to resolve actual source URLs
   - Include metadata (source type, timestamps for videos)
   - Pre-populate all link information

5. **Emerging Signals Detection**
   - Identify new patterns not seen in previous weeks
   - Mark with `first_surfaced` date
   - Same structure as subthemes but with temporal flag

### Frontend Display Requirements

1. **Dynamic Theme Rendering**
   - Map `feature` names to appropriate icons
   - Support configurable color schemes
   - Handle variable number of features per week

2. **Expandable Subthemes**
   - Maintain current expand/collapse functionality
   - Display sentiment badges with appropriate styling
   - Render quotes with proper formatting

3. **Source Link Handling**
   - Support multiple source types (YouTube, Reddit, etc.)
   - Handle timestamped links for videos
   - Display appropriate icons per source type

4. **Archive Navigation**
   - Generate archive weeks from available JSON files
   - Support week-based navigation
   - Highlight current week

## File Organization

```
/api/insights/
  └── weekly/
      ├── 2025-W28.json
      ├── 2025-W27.json
      └── 2025-W26.json
```

## API Endpoints

```typescript
// Get specific week data
GET /api/insights/weekly/{year}-W{week}
Response: WeeklyDigest JSON

// Get available weeks
GET /api/insights/weeks
Response: Array of available week identifiers

// Get current week
GET /api/insights/current
Response: WeeklyDigest JSON for current week
```

## Frontend Implementation Notes

1. **Component Updates Needed**
   - Replace hardcoded data with JSON consumption
   - Add loading states for API calls
   - Implement error handling for missing weeks
   - Add week navigation controls

2. **Icon Mapping**
   - Create mapping object for feature names to Lucide icons
   - Default fallback icon for unmapped features
   - Support dynamic icon assignment via JSON

3. **Styling Considerations**
   - Maintain current visual design
   - Support dynamic color schemes per feature
   - Ensure responsive layout with variable content lengths

## Data Validation

The frontend should validate incoming JSON structure and handle:
- Missing or malformed data gracefully
- Empty weeks (no content)
- Variable numbers of features/subthemes
- Broken or missing source links

## Success Metrics

1. **Performance**: Page load under 2 seconds with full week data
2. **Flexibility**: Support 1-15 features per week dynamically
3. **Reliability**: Graceful degradation when data is missing
4. **Maintainability**: No hardcoded content in frontend components

## Timeline

- **Phase 1**: JSON schema finalization and backend API design
- **Phase 2**: Frontend component refactoring for dynamic data
- **Phase 3**: Integration testing and error handling
- **Phase 4**: Performance optimization and caching strategy
